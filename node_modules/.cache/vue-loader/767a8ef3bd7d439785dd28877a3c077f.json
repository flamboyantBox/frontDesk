{"remainingRequest":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\src\\views\\siteNavigation\\siteNavigation.vue?vue&type=style&index=0&id=0c238165&lang=stylus&scoped=true&","dependencies":[{"path":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\src\\views\\siteNavigation\\siteNavigation.vue","mtime":1666791118480},{"path":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\node_modules\\css-loader\\dist\\cjs.js","mtime":1657531772627},{"path":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1657531782691},{"path":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\node_modules\\postcss-loader\\src\\index.js","mtime":1657531765577},{"path":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\node_modules\\stylus-loader\\index.js","mtime":1657531766810},{"path":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1657531780205},{"path":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657531754241},{"path":"C:\\Users\\Asua\\Desktop\\冯子君_23届_毕业设计\\template01\\solarBlog\\solarBlog-web\\frontDesk\\node_modules\\vue-loader\\lib\\index.js","mtime":1657531777312}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoudGVzdHsKICAgIDo6di1kZWVwIC5lbC10YWJsZV9faGVhZGVyIC5lbC10YWJsZS1jb2x1bW4tLXNlbGVjdGlvbiAuY2VsbCAuZWwtY2hlY2tib3g6YWZ0ZXIgewogICAgICAgIGNvbG9yOiAjOTA5Mzk5OwogICAgICAgIGNvbnRlbnQ6ICLlhajpgIkiOwogICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICBtYXJnaW4tbGVmdDogMnB4OwogICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgfQp9CmEgewogICAgY29sb3I6ICMwMDA7CiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICBmb250LXNpemU6IDUwcHg7Cn0KdGh7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXIhaW1wb3J0YW50Owp9Ci50b3RhbHsKICAgIG1hcmdpbi10b3A6IDMwcHg7Cn0KLm1yMzB7CiAgICBtYXJnaW4tcmlnaHQ6IDMwcHg7Cn0KLnJlc3VsdHsKICAgIGNvbG9yIHJlZDsKfQo="},{"version":3,"sources":["siteNavigation.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"siteNavigation.vue","sourceRoot":"src/views/siteNavigation","sourcesContent":["<template>\r\n    <v-card class=\"blog-container\">\r\n        <div class=\"test\">\r\n            <el-table\r\n                    ref=\"multipleTable\"\r\n                    :data=\"tableData\"\r\n                    tooltip-effect=\"dark\"\r\n                    style=\"width: 100%\"\r\n                    @selection-change=\"handleSelectionChange\">\r\n\r\n                <el-table-column\r\n                        type=\"selection\"\r\n                        width=\"55\">\r\n                </el-table-column>\r\n\r\n                <el-table-column\r\n                        prop=\"articleCover\"\r\n                        label=\"图片\"\r\n                        width=\"180\"\r\n                        align=\"center\"\r\n                >\r\n                    <template slot-scope=\"scope\">\r\n                        <el-image\r\n                                class=\"article-cover\"\r\n                                :src=\"\r\n                    scope.row.articleCover\r\n                ? scope.row.articleCover\r\n                : 'https://graduation-project-flam.oss-cn-hangzhou.aliyuncs.com/2022-07-21/aniya.webp'\r\n            \"\r\n                        />\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                        prop=\"item\"\r\n                        label=\"商品名称\"\r\n                        width=\"120\">\r\n                    <template slot-scope=\"scope\">{{ scope.row.articleTitle }}</template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                        prop=\"price\"\r\n                        label=\"价格(¥)\"\r\n                        width=\"120\">\r\n                    <template slot-scope=\"scope\">{{ scope.row.totalFee }}</template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                        prop=\"num\"\r\n                        label=\"数量\"\r\n                        width=\"120\">\r\n                    <template slot-scope=\"scope\">{{ scope.row.articleNum }}</template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                        prop=\"\"\r\n                        label=\"操作\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button size=\"medium\" @click=\"addNum(scope.$index)\">+</el-button>\r\n                        <el-button size=\"medium\" @click=\"reduceNum(scope.row.id, scope.row.articleId, scope.$index)\">-</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                        prop=\"price\"\r\n                        label=\"合计(¥)\"\r\n                        width=\"120\">\r\n                    <template slot-scope=\"scope\">{{ scope.row.totalFee * scope.row.articleNum }}</template>\r\n                </el-table-column>\r\n            </el-table>\r\n        </div>\r\n\r\n<!--        v-if=\"$store.state.num\"-->\r\n        <div class=\"total\" >\r\n            <span class=\"mr30\">已选数量：<i class=\"result\">{{selectedNum}}</i></span>\r\n            <span class=\"mr30\">金额：<i class=\"result\">{{selectedPay}}</i></span>\r\n            <el-button size=\"medium\" style=\"background-color: #67C23A; color: white\" @click=\"wechatPay\">微信</el-button>\r\n            <el-button size=\"medium\" style=\"background-color: #409EFF; color: white\" @click=\"aliPay\">支付宝</el-button>\r\n        </div>\r\n    </v-card>\r\n</template>\r\n\r\n<script>\r\n    import { getOrderList, deleteOrder } from \"../../api/user\";\r\n\r\n    export default {\r\n        created() {\r\n            this.orderList();\r\n        },\r\n        // 每隔三秒调用一次订单状态的方法\r\n        mounted() {\r\n            this.timer = setInterval(() => {\r\n                this.axios.get(\"http://localhost:8003/alipay/core/status\").then(res => {\r\n                    this.status = res.data;\r\n                    console.log(\"status1\", this.status)\r\n                    if (this.status){\r\n                        this.axios.get(\"http://localhost:8003/alipay/core/changeFalse\")\r\n                        clearInterval(this.timer)\r\n                        this.$router.push({path: \"/reception\"})\r\n                        this.selectedNum = 0,\r\n                        this.selectedPay = 0,\r\n                        this.articleIdList = [],\r\n                        this.orderNoList = []\r\n                        this.status = false;\r\n                        console.log(\"status2\", this.status)\r\n                        console.log(\"end\")\r\n                    }\r\n                });\r\n            },3000)\r\n        },\r\n        data() {\r\n            return {\r\n                tableData: [],\r\n                articleIdList: [],\r\n                selectedNum: 0,\r\n                selectedPay: 0,\r\n                selectedArray: [],\r\n                orderNoList: [],\r\n                timer: \"\",\r\n                status: false,\r\n            }\r\n        },\r\n\r\n        methods: {\r\n            handleSelectionChange(val) {\r\n                this.selectedNum = 0;\r\n                this.selectedPay = 0;\r\n                for (var i = 0, len = val.length; i < len; i++) {\r\n                    this.selectedNum += val[i].articleNum;\r\n                    this.selectedPay += val[i].articleNum * val[i].totalFee\r\n                }\r\n                this.selectedArray = val\r\n            },\r\n            // 加数量\r\n            addNum (index) {\r\n                let params = {\r\n                    articleId: this.tableData[index].articleId,\r\n                    articleTitle: this.tableData[index].articleTitle,\r\n                    articleCover: this.tableData[index].articleCover,\r\n                    userId: this.$store.state.userId,\r\n                    nickname: this.$store.state.nickname,\r\n                    email: this.$store.state.email,\r\n                    totalFee: this.tableData[index].totalFee,\r\n                };\r\n                this.axios.post(\"http://localhost:8003/wechat/core/createOrder\", params).then(res => {\r\n                    this.tableData[index].articleNum = res.data.data.articleNum;\r\n                })\r\n            },\r\n            // 减数量\r\n            reduceNum (orderId, articleId, index) {\r\n                if (this.tableData[index].articleNum > 0){\r\n                    deleteOrder(orderId, articleId).then(res => {\r\n                        this.tableData[index].articleNum = res.data.articleNum;\r\n                        this.tableData[index].id = res.data.id;\r\n                    })\r\n                }else {\r\n                    this.tableData[index].articleNum = 0\r\n                }\r\n\r\n            },\r\n            // 结算\r\n            wechatPay () {\r\n                if (this.selectedNum > 0) {\r\n                    let articleTitle;\r\n                    for (let i = 0, len = this.selectedArray.length; i < len; i++) {\r\n                        this.articleIdList.push(this.selectedArray[i].articleId);\r\n                        articleTitle = this.selectedArray[i].articleTitle;\r\n                        this.orderNoList.push(this.selectedArray[i].orderNo);\r\n                    }\r\n                    let params = {\r\n                        articleIdList: this.articleIdList,\r\n                        totalFee: this.selectedPay,\r\n                        articleTitle: articleTitle,\r\n                        orderNo: this.orderNoList[0]\r\n                    };\r\n\r\n                    this.$router.push({\r\n                        path: \"/payment\",\r\n                        query: {\r\n                            params: encodeURIComponent(JSON.stringify(params))\r\n                        }\r\n                    })\r\n                    this.selectedNum = 0,\r\n                    this.selectedPay = 0,\r\n                    this.articleIdList = [],\r\n                    this.orderNoList = [],\r\n                    articleTitle = \"\"\r\n                } else {\r\n                    this.$message({\r\n                        message: '请先选择结算的商品～',\r\n                        type: 'warning'\r\n                    })\r\n                }\r\n            },\r\n            aliPay () {\r\n                if (this.selectedNum > 0) {\r\n                    for (let i = 0, len = this.selectedArray.length; i < len; i++) {\r\n                        this.articleIdList.push(this.selectedArray[i].articleId);\r\n                        this.orderNoList.push(this.selectedArray[i].orderNo);\r\n                    }\r\n\r\n                    window.open(`http://localhost:8003/alipay/core/pay?subject=${this.articleIdList}&totalAmount=${this.selectedPay}&traceNo=${this.orderNoList[0]}`);\r\n                    console.log(\"start\")\r\n                } else {\r\n                    this.$message({\r\n                        message: '请先选择结算的商品～',\r\n                        type: 'warning'\r\n                    })\r\n                }\r\n            },\r\n            orderList() {\r\n                getOrderList(this.$store.state.userId).then(res => {\r\n                    this.tableData = res.data.orderList;\r\n                })\r\n            }\r\n        },\r\n    }\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n    .test{\r\n        ::v-deep .el-table__header .el-table-column--selection .cell .el-checkbox:after {\r\n            color: #909399;\r\n            content: \"全选\";\r\n            font-size: 14px;\r\n            margin-left: 2px;\r\n            font-weight: bold;\r\n        }\r\n    }\r\n    a {\r\n        color: #000;\r\n        text-decoration: none;\r\n        font-size: 50px;\r\n    }\r\n    th{\r\n        text-align: center!important;\r\n    }\r\n    .total{\r\n        margin-top: 30px;\r\n    }\r\n    .mr30{\r\n        margin-right: 30px;\r\n    }\r\n    .result{\r\n        color red;\r\n    }\r\n</style>\r\n"]}]}